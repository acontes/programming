<?xml version="1.0" encoding="UTF-8"?>
<project basedir="compile">
	<taskdef name="if" classname="ise.antelope.tasks.IfTask"/>

	<property environment="env" />

	<property name="base.dir"           value="${basedir}/.." />
	<property name="lib.dir"            value="${base.dir}/lib" />
	<property name="src.dir"            value="${base.dir}/src" />
	<property name="scripts.dir"         value="${base.dir}/scripts" />
	<property name="compile.dir"         value="${base.dir}/compile" />
	<property name="dev.dir"            value="${base.dir}/dev" />
	<property name="descriptors.dir"    value="${base.dir}/descriptors" />
	<property name="daemon.dir"         value="${base.dir}/p2p" />
	<property name="classes.dir"        value="${base.dir}/classes" />
	<property name="test.classes.dir"   value="${base.dir}/test-classes" />
	<property name="classlibs.dir"      value="${base.dir}/classlibs" />

	<property name="junit.dir"          value="${base.dir}/junitReports" />
	<property name="emma.dir"           value="${base.dir}/emmaReports" />

	<property name="deploy.dir"         value="${base.dir}/dist" />
	<property name="deploy.lib.dir"     value="${deploy.dir}/lib" />
	<property name="deploy.scripts.dir" value="${deploy.dir}/scripts" />
	
	<property name="release.dir"        value="${base.dir}/release" />
	
	<property name="src.proactive.dir"  value="${src.dir}/Core" />
	<property name="src.extensions.dir" value="${src.dir}/Extensions" />
	<property name="src.extra.dir"      value="${src.dir}/Extra" />
	<property name="src.examples.dir"   value="${src.dir}/Examples" />
	<property name="src.test.dir"       value="${src.dir}/Tests" />
	<property name="src.utils.dir"      value="${src.dir}/Utils" />
	<property name="src.benchmarks.dir" value="${src.dir}/Benchmarks" />

	<property name="cl.proactive.dir"   value="${classes.dir}/Core" />
	<property name="cl.extensions.dir"  value="${classes.dir}/Extensions" />
	<property name="cl.extra.dir"  		value="${classes.dir}/Extra" />
	<property name="cl.examples.dir"    value="${classes.dir}/Examples" />
	<property name="cl.test.dir"        value="${classes.dir}/Tests" />
	<property name="cl.utils.dir"       value="${classes.dir}/Utils" />
	<property name="cl.benchmarks.dir"  value="${classes.dir}/Benchmarks" />
	
	<property name="proactive.path" 	value="org/objectweb/proactive" />
	<property name="proactive.core.path" value="${proactive.path}/core" />
	<property name="proactive.ext.path" value="${proactive.path}/ext" />
	<property name="extensions.path"    value="${proactive.path}/extensions"/>
	<property name="extra.path"    		value="${proactive.path}/extra"/>
	
	<!-- ================================================================ -->
	<!--                   Doc directories paths                          -->
	<!--  =============================================================== -->
	<property name="doc.src"       		value="${base.dir}/doc-src" />
	<property name="docs.dir"      		value="${base.dir}/docs" />
	<property name="docs.tmp.dir"  		value="${docs.dir}/tmp" />
	<property name="docs.xsl"	value="${doc.src}/xsl" />

	<property name="docs.api.complete.dir"	value="${docs.dir}/javadoc/api_complete" />
	<property name="docs.api.published.dir"	value="${docs.dir}/javadoc/" />
	<property name="docs.docbook"	value="${base.dir}/dev/lib/docbook" />
	
	<property name="docs.html.multiple.dir"	value="${docs.dir}/manual/ProActive_Manual_html/" />
	<property name="docs.html.single.dir"	value="${docs.dir}/manual/ProActive_Manual_Single_html/" />
	<property name="docs.pdf.dir"	value="${docs.dir}/manual/pdf/" />

	
	<property name="docs.mainFile" 		value="PA_index.xml" />
	<property name="snippets.location"	value="${doc.src}/automatic_snippets" />
	
	 <property name="extra.format.dir" value=""/>
	<!-- ================================================================ -->
	<!--                Documentation files:   XSL,XML,PDF,etc            -->
	<!--  =============================================================== -->
	<property name="docs.pdf.name"	value="ProActive_Manual.pdf" />
	
	<property name="docs.published.coreclasses" 		value="${docs.tmp.dir}/publishedCoreClasses" />
	<property name="docs.published.extensionsclasses" 	value="${docs.tmp.dir}/publishedExtensionsClasses" />
	<property name="docs.published.extraclasses" 	value="${docs.tmp.dir}/publishedExtraClasses" />
	<property name="docs.xsl.profiling"	value="${docs.xsl}/profiling.xsl" />
	<property name="docs.xsl.pdf"	value="${docs.xsl}/pdf.xsl" />
	<property name="docs.xsl.html.chunked"	value="${docs.xsl}/chunkedhtml.xsl" />
	<property name="docs.xsl.html.one"	value="${docs.xsl}/onehtml.xsl" />
	<property name="docs.xsl.removenewlines"	value="${docs.xsl}/remove_newlines.xsl" />

	<property name="docs.html.multiple.zip"	value="${docs.dir}/ProActive_Manual_html.zip" />
	<property name="docs.html.single.zip"	value="${docs.dir}/ProActive_Manual_html_single.zip" />


	<property name="docs.html.multiple.output"	value="${docs.html.multiple.dir}/index.html" />
	<property name="docs.html.single.name"	value="ProActiveManual.html" />
	<property name="docs.html.single.output"	value="${docs.html.single.dir}/${docs.html.single.name}" />
	<property name="docs.pdf.output"	value="${docs.pdf.dir}/${docs.pdf.name}" />


	<property name="docs.docbook.dtd.name"	value="docbook.dtd" />
	<property name="docs.docbook.dtd"	value="${docs.dir}/${docs.docbook.dtd.name}" />
	<property name="docs.html.css.name"	value="ProActive.css" />
	
	<!-- Javac properties -->
	<property name="debug" value="on" />
	<property name="source" value="1.5" />

	<!-- Clover -->
	<property name="clover.report.dir"        value="${base.dir}/clover" />
	<property name="clover.historyreport.dir" value="${base.dir}/clover_history" />
	<property name="clover.historypoint.dir"  value="${base.dir}/clover_db" />


	<!-- Osgi properties -->
	<property name="osgi.manifest.dir" value="${src.extensions.dir}/org/objectweb/proactive/extensions/osgi/Manifest/" />
	<property name="manifest.example.dir" value="${src.examples.dir}/org/objectweb/proactive/examples/osgi/hello/Manifest/" />
	<property name="bundle.dir" value="${base.dir}/dist/bundle" />
	<property name="osgi.res.dir" value="${src.extensions.dir}/org/objectweb/proactive/extensions/osgi/res/"/>
	<property name="manifest.connector.dir" value="${src.extensions.dir}/org/objectweb/proactive/extensions/osgi/connector/Manifest/"/>
	<property name="manifest.example.management.dir" value="${src.examples.dir}/org/objectweb/proactive/examples/jmx/remote/management/osgi/Manifest/"/>
	<property name="example.management.classes.dir" value="${classes.dir}/Examples/org/objectweb/proactive/examples/jmx/remote/management/"/>	
	
	<!-- IC2d properties -->
	<property name="ic2d-plugin.dir" value="${base.dir}/ic2d-plugins-src" />
	<property name="plugin.lib" value="org.objectweb.proactive.ic2d.lib" />
	
	<property name="stubgenerator.class" value="org.objectweb.proactive.ext.util.StubGenerator" />
	
	<!-- junit properties -->
	<property name="junit.showoutput" value="false"/>

	<!-- Performance test properties -->
	<property name="performanceTestClass" value="performanceTests.simple.PerformanceTest" />
	<property name="config.dir" value="${cl.proactive.dir}/${proactive.core.path}/config" />

	<!-- DocBook -->
	<property name="docbook.version" value="ns-1.74.0" />
	
	<!-- ================================================================ -->
	<!--                   define the different classpaths                -->
	<!--  =============================================================== -->

	<path id="compile.libs">
		<fileset dir="${lib.dir}">
			<include name="*.jar" />
		</fileset>
		<!-- XXX ${dev.dir} is not included in the source release ! -->
		<pathelement location="${base.dir}/compile/lib/junit-4.3.jar"/>
	</path>
	
	<path id="deploy.classpath">
		<fileset dir="${deploy.lib.dir}">
			<include name="**/*.jar"/>
			<exclude name="**/ProActive_tests.jar"/>
		</fileset>
	</path>
	
	<path id="test.classpath">
		<path refid="deploy.classpath"/>
		<pathelement location="${base.dir}/compile/lib/junit-4.3.jar"/>
		<pathelement location="${cl.test.dir}/" />
	</path>

	<path id="project.classpath">
		<pathelement location="${cl.proactive.dir}" />
		<pathelement location="${cl.extensions.dir}" />
		<pathelement location="${cl.extra.dir}" />
		<pathelement location="${cl.utils.dir}" />
		<pathelement location="${cl.test.dir}"/>
		<path refid="compile.libs"/>
	</path>

	<macrodef name="compile_extra">
		<attribute name="module" />
		<sequential>
			<compile_module 
				module="@{module}" 
				sourcepath="${src.extra.dir}"
				package="${extra.path}"
				dest="${cl.extra.dir}">
				<appendclasspath>
					<pathelement location="${cl.extensions.dir}"/>
				</appendclasspath>
			</compile_module>
		</sequential>
	</macrodef>

	<macrodef name="compile_extension">
		<attribute name="module" />
		<sequential>
			<compile_module 
				module="@{module}" 
				sourcepath="${src.extensions.dir}"
				package="${extensions.path}"
				dest="${cl.extensions.dir}"/>
		</sequential>
	</macrodef>

	<macrodef name="compile_module">
		<attribute name="module" />
		<attribute name="sourcepath"/>
		<attribute name="package"/>
		<attribute name="dest"/>
		<element name="appendclasspath" optional="yes"/>
		<sequential>
			<mkdir dir="${cl.extensions.dir}"/>

			<if name="proactive.jar">
				<else>
					<!-- Try to automagically find the classes/ -->
					<property name="proactive.jar" location="${cl.proactive.dir}"/>
				</else>
			</if>

			<echo>Compiling  ___@{module}___</echo>
			<!-- <echo>  [i] ProActive:  ${proactive.jar}</echo> -->

			<echo>  [i] src:  @{sourcepath}/@{package}/@{module}</echo>
			<echo>  [i] dest: @{dest}</echo>
			<echo>  [i] cp:   ${proactive.jar}</echo>

			<javac 
			 srcdir="@{sourcepath}" 
			 destdir="@{dest}" 
			 deprecation="on" 
			 source="${source}" 
			 debug="${debug}"
			 failonerror="true">
				<!-- <compilerarg value="-Xlint:unchecked"/> -->
				<classpath>
					<path refid="compile.libs"/>
					<pathelement location="${proactive.jar}"/>
				
					<!-- XXX temporary workaround to allow functional tests to be moved in extra -->
					<pathelement location="${cl.test.dir}"/>
					
					<appendclasspath />
				</classpath>
				<include name="@{package}/@{module}/**/*.java" />
			</javac>

			<copy todir="@{dest}" includeEmptyDirs="no">
				<fileset dir="@{sourcepath}">
					<exclude name="**/*.java" />
				</fileset>
			</copy>

		</sequential>
	</macrodef>

</project>
