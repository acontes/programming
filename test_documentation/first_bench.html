<!DOCTYPE HTML PUBLIC "-//IETF//Dtd HTML//EN"><html><head><title>ProActive Test Suite API</title>

<link rel="stylesheet" href="Files/ProActive.css"></head>

  <body bgcolor="#ffffff">
<table width="100%">
  <tbody><tr>
    <td align="left" valign="middle"> <table cellpadding="2" cellspacing="0" border="1">
        <tbody><tr>
          <td class="smallLink1">&nbsp;&nbsp;<a class="smallLink1" href="index.html">back
to index</a>&nbsp;&nbsp;</td>
          <td class="smallLink2">&nbsp;&nbsp;<a class="smallLink2" href="first_test.html">prev</a>&nbsp;&nbsp;</td>
          <td class="smallLink2">&nbsp;&nbsp;<a class="smallLink2" href="howto.html">next</a>&nbsp;&nbsp;</td>
        </tr>
      </tbody></table></td>
    <td align="right" valign="top"> <a href="http://www-sop.inria.fr/oasis/ProActive/"><img src="Files/ProActiveLogo200x34.gif" width="200" height="34" border="0"></a>
    </td>
  </tr>
</tbody></table>
<hr>
<h1>2. Your first Benchmark</h1>

<p>This section describes how to write and execute a simple Benchmark.</p>

<h2>Description</h2>

<p>For this example, we choose to measure the time of an object creation with
<b>ProActive.newActive()</b>. This benchmark aims to perform object creation
on the same JVM, on an other local JVM and on a remote JVM.</p>

<h2>First step : write the Benchmark</h2>

<p>Create  new class who extends <b>testsuite.test.ProActiveBenchmark</b>, it
is an abstract class.</p>

<p>See this template code :</p>

<pre>
<code>
import org.objectweb.proactive.ProActive;
import org.objectweb.proactive.core.node.Node;

import testsuite.test.ProActiveBenchmark;

public class BenchNewActive extends ProActiveBenchmark {

    public BenchNewActive() {
        super(null, "Object Creation with newActive",
            "Measure time to create an active object with newActive.");
    }

    public BenchNewActive(Node node) {
        super(node, "Object Creation with newActive",
            "Measure time to create an active object with newActive.");
    }

    public long action() throws Exception {
    }

    public void initTest() throws Exception {
    }

    public void endTest() throws Exception {
    }
}
</code>
</pre>

<p>We also override two methods from the super-class :
<b>testsuite.test.Benchmark</b>, to check if post and pre-conditions are
verified :</p>

<pre>
<code>
   public boolean postConditions() throws Exception {
   }

   public boolean preConditions() throws Exception {
   }
</code>
</pre>

<h3>Implementing initTest() and endTest()</h3>

<p>In this exampple both methods are empty, but they could be overridden in
order to initialize and finalyze the benchmark.</p>

<h3>Implementing preConditions()</h3>

<p>We will simply verify if the node is created :</p>

<pre>
<code>
   public boolean preConditions() throws Exception {
     return getNode() != null;
   }
</code>
</pre>

<h3>Implementing action()</h3>

<p>This method measures the time of a creation of an Object with
ProActive.newActive() on a specified node :</p>

<pre>
<code>
    private ReifiableObject object = null;

    public long action() throws Exception {
        ReifiableObject object;
        String className = ReifiableObject.class.getName();
        Node node = getNode();
        this.timer.start();
        object = (ReifiableObject) ProActive.newActive(className, null, node);
        this.timer.stop();
        return this.timer.getCumulatedTime();
    }
</code>
</pre>

<p><b>Remark :</b>It is the benchmark's programmer who measure the time of the
action with a configurable timer, see the <a href="timer.html">timer part</a> for more 
details.</p>

<p><b>Remark :</b> The <b>ReifiableObject</b> class is a simple class who
just extends <b>java.lang.Object</b>, implements <b>java.io.Serilizable</b>
and has an empty constructor with no argument.</p>

<h3>Implementing postConditions()</h3>

<p>We will check if object is different of null and if the node contains
object :</p>

<pre>
<code>
   public boolean postConditions() throws Exception {
     Object[] activeObjects = getNode().getActiveObjects();
     return (object != null) && (activeObjects != null) &&
       (activeObjects.length == 1) && activeObjects[0].equals(object);
   }
</code>
</pre>

<p><b>Tips :</b>  if you want to make a trace in your benchmark , you have
access to a log4j logger by : <b>getLogger()</b> or by the variable
<b>logger</b></p>

<h2>Second step : write a manager</h2>

<p>Now, we will write a <b>Manager</b> to execute ou test.</p>

<p>For this example it is very simple, you have just to extends
<b>testsuite.manager.ProActiveBenchManager</b> :</p>

<pre>
<code>
import testsuite.manager.ProActiveBenchManager;

public class Manager extends ProActiveBenchManager {

	public Manager() {
          super("Manager","To manage ProActive Benchmarks.");
	}
}
</code>
</pre>

<h3>Override initManager() and endManager()</h3>

<p>Normaly, you have nothing to do to initialize the manager. In this example,
we choose to create benchmarks and group in this method , but you can do this
in the same place where you create the manager.</p>

<p>Create group by <b>initManager()</b> :</p>

<pre>
<code>
import testsuite.group.Group;

  public void initManager() throwsException {
    Group benchGroup = new Group("Bnechmark Group","no description.");

    // adding bench in same VM
    benchGroup.add(new BenchNewActive(getSameVMNode()));
    // adding bench in local VM
    benchGroup.add(new BenchNewActive(getLocalVMNode()));
    // adding bench in remote VM
    benchGroup.add(new BenchNewActive(getRemoteVMNode()));

    // adding the group
    add(benchGroup);
  }
</code>
</pre>

<p>Create group int the <b>same place</b> of the manager :</p>

<pre>
<code>
  // ...
  Manager manager  = new Manager();

  Group  benchGroup = new Group("Bnechmark Group","no description.");

  // adding bench in same VM
  benchGroup.add(new BenchNewActive(getSameVMNode()));
  // adding bench in local VM
  benchGroup.add(new BenchNewActive(getLocalVMNode()));
  // adding bench in remote VM
  benchGroup.add(new BenchNewActive(getRemoteVMNode()));

  manager.add(benchGroup);
  // ...
</code>
</pre>

<p><b>Warning :</b> if you override <b>endManager()</b> method in a
<b>ProActiveManager</b> you must to add in this code :</p>

<pre>
<code>
super.endManager()
</code>
</pre>

<p>The reason is to delete the ProActive nodes create at the beginning.</p>

<h3>The attribute file</h3>

<p>Our manager is a <b>ProActiveManager</b>, so an attibutes file is
mandatory.</p>

<p>Create a file <b>Manager.prop</b> in the same directory of the
manager. This file must contains the name (or URL) of the remote host, like
this :</p>

<pre>
<code>
RemoteHostname=owenii
</code>
</pre>

<p><b>Warning :</b> respect the upper an lower cases.</p>

<p><b>Tips :</b> you can use this file to specify attributes for your tests
classes. You can also use a different file, in this case you must specify its
path in the <code>execute()</code> method of the manager.</p>

<h2>Now launch the benchmark ...</h2>

<p>Add this code in your <code>main</code> method :</p>

<pre>
<code>
Manager manager = new Manager();
// the argument must have true value, because it is a ProActiveManager
// and the attributes file is obligatory
manager.execute(true);
</code>
</pre>

<p><b>Warning :</b> when you use a <b>ProActiveManager</b> you must to had
<b>System.exit(0)</b> at the end of the main method. If don't do that, the
manager can't properly.</p>

<h3>Get the results</h3>

<p>Results in your console :</p>

<pre>
<code>
System.out.println(manager);
</code>
</pre>

<p>If you want all details :</p>

<pre>
<code>
manager.setVerbatim(true);
</code>
</pre>

<p>For benchmarks it is more interesting to export results in a HTML
file. Indeed, you have average, min, max, STDEV and charts to help you to
analyse all results</p>

<table align="center" width="96%" border="1" cellpadding="5"
 cellspacing="0">
  <tbody>
    <tr>
      <th align="center" bgcolor="#ccccff">Example of HTML results</th>
    </tr>
    <tr>
      <td>
 <h3>Object Creation</h3>
<p>Object Creation with newActive and turnActive.</p>

 <h4>Messages of Object Creation :</h4>
      <p>9/18/2003 at 13:0:32.527<b><span style="color: rgb(0, 0, 255);"> [RESULT] </span></b>Object Creation with newActive -- Same VM : no message<b><span style="color: rgb(0, 255, 0);"> [SUCCESS] </span></b><a href="Bench.png">See the chart</a> Max=113ms Moy=24.0ms STDEV=24.64ms --&gt; <i>Min </i><b>1</b><i>ms</i></p>

      <p>9/18/2003 at 13:0:36.693<b><span style="color: rgb(0, 0, 255);"> [RESULT] </span></b>Object Creation with turnActive -- Same VM : no message<b><span style="color: rgb(0, 255, 0);"> [SUCCESS] </span></b><a href="Bench1.png">See the chart</a> Max=98ms Moy=41.0ms STDEV=32.20ms --&gt; <i>Min </i><b>1</b><i>ms</i></p>
      <p>9/18/2003 at 13:0:43.425<b><span style="color: rgb(0, 0, 255);"> [RESULT] </span></b>Object Creation with newActive -- Local VM : no message<b><span style="color: rgb(0, 255, 0);"> [SUCCESS] </span></b><a href="Bench2.png">See the chart</a> Max=376ms Moy=67.03ms STDEV=83.73ms --&gt; <i>Min </i><b>6</b><i>ms</i></p>

      <p>9/18/2003 at 13:0:50.434<b><span style="color: rgb(0, 0, 255);"> [RESULT] </span></b>Object Creation with turnActive -- Local VM : no message<b><span style="color: rgb(0, 255, 0);"> [SUCCESS] </span></b><a href="Bench3.png">See the chart</a> Max=326ms Moy=69.82ms STDEV=86.15ms --&gt; <i>Min </i><b>6</b><i>ms</i></p>
      <p>9/18/2003 at 13:0:53.297<b><span style="color: rgb(0, 0, 255);"> [RESULT] </span></b>Object Creation with newActive -- Remote VM : no message<b><span style="color: rgb(0, 255, 0);"> [SUCCESS] </span></b><a href="Bench4.png">See the chart</a> Max=290ms Moy=28.03ms STDEV=50.79ms --&gt; <i>Min </i><b>5</b><i>ms</i></p>

      <p>9/18/2003 at 13:0:55.980<b><span style="color: rgb(0, 0, 255);"> [RESULT] </span></b>Object Creation with turnActive -- Remote VM : no message<b><span style="color: rgb(0, 255, 0);"> [SUCCESS] </span></b><a href="Bench5.png">See the chart</a> Max=250ms Moy=26.32ms STDEV=53.46ms --&gt; <i>Min </i><b>5</b><i>ms</i></p>
      <p>9/18/2003 at 13:0:55.982<b><span style="color: rgb(0, 0, 255);"> [RESULT] </span></b> : Group : Object Creation, Moy in 42.7ms Runs : 600 Errors : 0
      </p>

      <p>To see all results of this group in a <a href="Group1.png">BarChart</a>.
      </p>
      </td>
    </tr>
  </tbody>
</table>


<h2>All the Code</h2>

<table align="center" width="96%" border="1" cellpadding="5"
 cellspacing="0">
  <tbody>
    <tr>
      <th align="center" bgcolor="#ccccff">BenchnewActive.java</th>
    </tr>
    <tr>
      <td>
<pre>
<code>
import org.objectweb.proactive.ProActive;
import org.objectweb.proactive.core.node.Node;

import testsuite.test.ProActiveBenchmark;
import util.ReifiableObject;

public class BenchNewActive extends ProActiveBenchmark {

    private ReifiableObject object = null;

    public BenchNewActive() {
        super(null, "Object Creation with newActive",
            "Measure time to create an active object with newActive.");
    }

    public BenchNewActive(Node node) {
        super(node, "Object Creation with newActive",
            "Measure time to create an active object with newActive.");
    }

    public long action() throws Exception {
        String className = ReifiableObject.class.getName();
        Node node = getNode();
        this.timer.start();
        object = (ReifiableObject) ProActive.newActive(className, null, node);
        this.timer.stop();
        return this.timer.getCumulatedTime();
    }

    public void initTest() throws Exception {
        // nothing to do
    }

    public void endTest() throws Exception {
        // nothing to do
    }

    public boolean preConditions() throws Exception {
        return getNode() != null;
    }
    
    public boolean postConditions() throws Exception {
	Object[] activeObjects = getNode().getActiveObjects();
	return (object != null) && (activeObjects != null) &&
	(activeObjects.length == 1) && activeObjects[0].equals(object);
    }
}
</code>
</pre>
      </td>
    </tr>
  </tbody>
</table>

<table align="center" width="96%" border="1" cellpadding="5"
 cellspacing="0">
  <tbody>
    <tr>
      <th align="center" bgcolor="#ccccff">ReifiableObject.java</th>
    </tr>
    <tr>
      <td>
<pre>
<code>
import java.io.Serializable;

public class ReifiableObject implements Serializable {

	public ReifiableObject() {
	}

}
</code>
</pre>  
      </td>
    </tr>
  </tbody>
</table>

<table align="center" width="96%" border="1" cellpadding="5"
 cellspacing="0">
  <tbody>
    <tr>
      <th align="center" bgcolor="#ccccff">Manager.prop</th>
    </tr>
    <tr>
      <td>
<pre>
<code>
RemoteHostname=owenii
</code>
</pre>
      </td>
    </tr>
  </tbody>
</table>

<table align="center" width="96%" border="1" cellpadding="5"
 cellspacing="0">
  <tbody>
    <tr>
      <th align="center" bgcolor="#ccccff">Manager.java</th>
    </tr>
    <tr>
      <td>
<pre>
<code>
import org.apache.log4j.BasicConfigurator;
import org.apache.log4j.HTMLLayout;
import org.apache.log4j.Level;
import org.apache.log4j.Logger;
import org.apache.log4j.WriterAppender;

import testsuite.group.Group;

import testsuite.manager.ProActiveBenchManager;

import java.io.File;

public class Manager extends ProActiveBenchManager {
    private Logger logger = Logger.getLogger(Test1.class);

    public Manager() {
        super("Manager","To manage ProActive Benchmarks.");
        // Log in a HTML file
        HTMLLayout layout = new HTMLLayout();
        WriterAppender appender = null;
        try {
            FileOutputStream output = new FileOutputStream(
                    "/net/home/adicosta/output2.html");
            appender = new WriterAppender(layout, output);
        } catch (Exception e) {
        }
        logger.addAppender(appender);
        BasicConfigurator.configure();
        logger.setLevel(Level.DEBUG);
    }

    public void initManager() throws Exception {
        Group benchGroup = new Group("Bnechmark Group","no description.");

        // adding bench in same VM
        benchGroup.add(new BenchNewActive(getSameVMNode()));
        // adding bench in local VM
        benchGroup.add(new BenchNewActive(getLocalVMNode()));
        // adding bench in remote VM
        benchGroup.add(new BenchNewActive(getRemoteVMNode()));

        // adding the group
        add(benchGroup);
    }

    public static void main(String[] args) {
        Manager manager = new Manager();

        // To run all benchmarks 100 times
        manager.setNbRuns(100);

        // Execute all benchmarks
        manager.execute(true);

        //Write results in a HTML file
        try {
            File file = new File(System.getProperty("user.home") +
                    File.separatorChar + "results.html");
            manager.toHTML(file);
        } catch (Exception e) {
            e.printStackTrace();
        }
        System.exit(0);
    }
}
</code>
</pre>
      </td>
    </tr>
  </tbody>
</table>
</body></html>
