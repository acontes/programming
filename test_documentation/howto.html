<!DOCTYPE HTML PUBLIC "-//IETF//Dtd HTML//EN">
<html>
<head>
  <title>ProActive Test Suite API</title>
  <link rel="stylesheet" href="Files/ProActive.css">
</head>
<body style="background-color: rgb(255, 255, 255);">
<table width="100%">
  <tbody>
    <tr>
      <td align="left" valign="middle">
      <table cellpadding="2" cellspacing="0" border="1">
        <tbody>
          <tr>
            <td class="smallLink1">&nbsp;&nbsp;<a class="smallLink1"
 href="index.html">back
to index</a>&nbsp;&nbsp;</td>
            <td class="smallLink2">&nbsp;&nbsp;<a class="smallLink2"
 href="first_bench.html">prev</a>&nbsp;&nbsp;</td>
            <td class="smallLink2">&nbsp;&nbsp;<a class="smallLink2"
 href="conclusion.html">next</a>&nbsp;&nbsp;</td>
          </tr>
        </tbody>
      </table>
      </td>
      <td align="right" valign="top"> <a
 href="http://www-sop.inria.fr/oasis/ProActive/"><img
 src="Files/ProActiveLogo200x34.gif" width="200" height="34" border="0"></a>
      </td>
    </tr>
  </tbody>
</table>
<hr>
<h1>3. How to create a Test Suite with interlinked Tests</h1>
<p>In this part we will not explain how to write a simple test, for
this see
<a href="first_test.html">Your first Test</a> section.</p>
<h2>Description of our Test</h2>
<p>In first step, we will test a ProActive Group creation with 3
Agents, and after this creation we will test
the Agents migration by a group communication.</p>
<h2>Root Test : ProActive Group Creation</h2>
<h3>A simply ProActiveTest</h3>
<p>Create a new class who extends <b>testsuite.test.ProActiveFunctionalTest</b>,
it is an abstract class.</p>
<p>See this template code :</p>
<pre><code><br>import org.objectweb.proactive.core.node.Node;<br><br>import testsuite.test.ProActiveFunctionalTest;<br><br>import java.io.Serializable;<br><br>public class TestGroupCreation extends ProActiveFunctionalTest<br>    implements Serializable {<br><br>    public TestGroupCreation() {<br>        super(null, "Group Creation",<br>            "Create a Group of active object in specify node.");<br>    }<br><br>    public TestGroupCreation(Node node) {<br>        super(node, "Group Creation",<br>            "Create a Group of active object in specify node.");<br>    }<br><br>    public void action() throws Exception {<br>    }<br><br>    public boolean postConditions() throws Exception {<br>    }<br><br>    public boolean preConditions() throws Exception {<br>    }<br><br>    public void initTest() throws Exception {<br>        // nothing to do<br>    }<br><br>    public void endTest() throws Exception {<br>        // nothing to do<br>    }<br>}<br></code></pre>
<p>Next we will simply test in preconditions if the node exists
(different of null) :</p>
<pre><code><br>    public boolean preConditions() throws Exception {<br>        return getNode() != null;<br>    }<br></code></pre>
<p>Now we will implement the action method to create a ProActive Group
with 3 Agent (see the Agent code at <a href="#agent">the end of
this document</a>) :</p>
<pre><code><br>import org.objectweb.proactive.core.group.Group;<br>import org.objectweb.proactive.core.group.ProActiveGroup;<br>public class TestGroupCreation extends ProActiveFunctionalTest<br>    implements Serializable {<br>    	private Agent group = null;<br>	<br>	// ...<br><br>	public void action() throws Exception {<br>        	createGroupAgent();<br>	}<br>	<br>	private void createGroupAgent() throws Exception {<br>        	Object[][] params = {<br>            		{ "Agent0" },<br>            		{ "Agent1" },<br>            		{ "Agent2" }<br>        	};<br>        	Node node = getNode();<br>        	Node[] nodes = { node };<br>        	group = (Agent) ProActiveGroup.newGroup(Agent.class.getName(), params,<br>         	nodes);<br>    	}<br><br>	// ...<br><br>}<br></code></pre>
<p><b>Remarks :</b> We use an external method to create the group is
for the simple reason of we use this code
after in another method.</p>
<p><b>Remarks :</b> We don't explain the Agent code because it is a
ProActive example.</p>
<p>For the postconditions we will test if the group containts 3
elements and they are in the good node :</p>
<pre><code><br>    public boolean postConditions() throws Exception {<br>        if (group == null) {<br>            return false;<br>        } else {<br>            Group agentGroup = ProActiveGroup.getGroup(group);<br>            if (agentGroup.size() != 3) {<br>                return false;<br>            } else {<br>                Agent agent0 = (Agent) agentGroup.get(0);<br>                Agent agent1 = (Agent) agentGroup.get(1);<br>                Agent agent2 = (Agent) agentGroup.get(2);<br>                String nodeURL = getNode().getNodeInformation().getURL()<br>                                     .toUpperCase();<br><br>                return (agent0.getNodeName().compareTo(nodeURL) == 0) &amp;&amp;<br>                (agent1.getNodeName().compareTo(nodeURL) == 0) &amp;&amp;<br>                (agent2.getNodeName().compareTo(nodeURL) == 0);<br>            }<br>        }<br>    }<br></code></pre>
<p>This class is now readi for a standalone use.</p>
<h3>Action method for interlinked mode</h3>
<p>Now, we will add a new <b>action</b> method who <b>return</b> a
ProActive Group :</p>
<pre><code><br>    public Agent action(Object o) throws Exception {<br>        createGroupAgent();<br>        return this.group;<br>    }<br></code></pre>
<p>This method return an Agent (who is the group) and have one argument
: o. This argument will not use
, we must to put this argument is for have a different method signature
from action().</p>
<p>Our test for group creation is now ready.</p>
<h2>An independant Test : A Group migration</h2>
<p>All the code is the same of the precedant class unexcepted for the
actions methods and for the method to create group of course.</p>
<h3>The default action method</h3>
<p>In this test we can't run this method in a standalone test, but for
other maybe you can. It is just for this
test.</p>
<pre><code><br>    public void action() throws Exception {<br>        throw new Exception("This test doesn't work in standalone mode");<br>    }<br></code></pre>
<h3>The action method for interlinked tests</h3>
<p>The result of the precedent test is an Agent, so the argument will
be an Agent. This test have no result but
we must to return an Object here it is null because the API use the
reflection mechanism of Java.</p>
<pre><code><br>    public Object action(Agent group) throws Exception {<br>        this.group = group;<br>        this.group.moveTo(getNode().getNodeInformation().getURL());<br>        return null;<br>    }<br></code></pre>
<h2>Run your tests</h2>
<p>Create a simple <b>ProActiveFuncTestManager</b> with a <b>main</b>
:</p>
<pre><code><br>import testsuite.manager.ProActiveFuncTestManager;<br><br>public class Manager extends ProActiveFuncTestManager {<br><br>    public Manager(String name, String description) {<br>        super(name, description);<br>    }<br><br>    public static void main(String[] args) {<br>        Manager manager = new Manager("Migration Tests",<br>                "Create a group and migrate its objects.");<br>    }<br>}<br></code></pre>
<p>Create a new Group (testsuite.group.Group) in our main :</p>
<pre><code><br>import testsuite.group.Group;<br><br>	// ...<br>	<br>	Group group = new Group("Group Migration",<br>                "Migration on an active group objects.");<br><br>	// ...<br></code></pre>
<p>Create and add the 2 precends tests in the group :</p>
<pre><code><br>	// ...<br>	<br>	TestGroupCreation creation = new TestGroupCreation(manager.getLocalVMNode());<br>        group.add(creation);<br><br>        TestGroupMigration migration = new TestGroupMigration(manager.getRemoteVMNode());<br>        group.add(migration);<br>	<br>	// ...<br></code></pre>
<p>Specify the ancestor test of migration is creation :</p>
<pre><code><br>	// ...<br><br>	FunctionalTest[] params = { creation };<br>        	migration.setTests(params);<br>		<br>	// ...<br></code></pre>

    <p>You can see in the <a href="descriptor.html">configuration file part</a> how to do
    this by a configuration file.</p>

<p><b>Warning : </b> Don't forget to write a prop file with the name
of the remote host.</p>
<p>Add the group and launch the test :</p>
<pre><code><br>	// ...<br>	<br>	manager.add(group);<br><br>        manager.execute(group, migration, true);<br>	<br>	// ...<br></code></pre>
<p><b>Warning :</b> when you use a ProActiveManager you must to had <b>System.exit(0)</b>
at the end of the <b>main</b> method. If don't do that, the manager
can't properly.</p>
<h3>An example of results for this test with verbatim option</h3>
<pre><code><br>8/26/03 12:40:47.407 [MESSAGE] Local hostname : amda.inria.fr<br>8/26/03 12:40:47.408 [MESSAGE] Remote hostname : owenii<br>8/26/03 12:40:47.498 [MESSAGE] Starting with interlinked Tests ...<br>8/26/03 12:40:47.498 [MESSAGE] Init Manager with success<br>8/26/03 12:40:48.547 [RESULT] Group Creation : Test run with success [SUCCESS]<br>8/26/03 12:40:50.149 [RESULT] Group Migration : Test run with success [SUCCESS]<br>8/26/03 12:40:50.149 [RESULT] Group : Group Migration Runs : 2 Errors : 0 [SUCCESS]<br>8/26/03 12:40:50.243 [MESSAGE] ... Finish<br></code></pre>
<h2>All the code</h2>
<table align="center" width="96%" border="1" cellpadding="5"
 cellspacing="0">
  <tbody>
    <tr>
      <th align="center" bgcolor="#ccccff">Manager.prop</th>
    </tr>
    <tr>
      <td>
      <pre> <code><br>RemoteHostname=owenii<br></code></pre>
      </td>
    </tr>
  </tbody>
</table>
<table align="center" width="96%" border="1" cellpadding="5"
 cellspacing="0">
  <tbody>
    <tr>
      <th align="center" bgcolor="#ccccff">Manager.java</th>
    </tr>
    <tr>
      <td>
      <pre> <code><br>import testsuite.group.Group;<br>import testsuite.manager.ProActiveFuncTestManager;<br><br>public class Manager extends ProActiveFuncTestManager {<br><br>    public Manager(String name, String description) {<br>        super(name, description);<br>    }<br><br>    public static void main(String[] args) {<br>        Manager manager = new Manager("Migration Tests",<br>                "Create a group and migrate its objects.");<br>        Group group = new Group("Group Migration",<br>                "Migration on an active group objects.");<br><br>        TestGroupCreation creation = new TestGroupCreation(manager.getLocalVMNode());<br>        group.add(creation);<br><br>        TestGroupMigration migration = new TestGroupMigration(manager.getRemoteVMNode());<br>        group.add(migration);<br><br>        FunctionalTest[] params = { creation };<br>        migration.setTests(params);<br><br>        manager.add(group);<br><br>        manager.execute(group, migration, true);<br><br>        manager.setVerbatim(true);<br>        manager.getResults().toOutPutStream(System.out);<br><br>        System.exit(0);<br>    }<br>}<br>  </code></pre>
      </td>
    </tr>
  </tbody>
</table>
<table align="center" width="96%" border="1" cellpadding="5"
 cellspacing="0">
  <tbody>
    <tr>
      <th align="center" bgcolor="#ccccff">TestGroupMigration.java</th>
    </tr>
    <tr>
      <td>
      <pre> <code><br> import java.io.Serializable;<br><br>import org.objectweb.proactive.core.group.Group;<br>import org.objectweb.proactive.core.group.ProActiveGroup;<br>import org.objectweb.proactive.core.node.Node;<br><br>import testsuite.test.ProActiveFunctionalTest;<br><br>public class TestGroupMigration extends ProActiveFunctionalTest<br>    implements Serializable {<br>    private Agent group = null;<br><br>    public TestGroupMigration() {<br>        super(null, "Group Migration",<br>            "Migrate all Group Element in a specified node.");<br>    }<br><br>    public TestGroupMigration(Node node) {<br>        super(node, "Group Migration",<br>            "Migrate all Group Element in a specified node.");<br>    }<br><br>    public boolean postConditions() throws Exception {<br>        if (group == null) {<br>            return false;<br>        } else {<br>            Group agentGroup = ProActiveGroup.getGroup(group);<br>            if (agentGroup.size() != 3) {<br>                return false;<br>            } else {<br>                Agent agent0 = (Agent) agentGroup.get(0);<br>                Agent agent1 = (Agent) agentGroup.get(1);<br>                Agent agent2 = (Agent) agentGroup.get(2);<br>                String nodeURL = getNode().getNodeInformation().getURL()<br>                                     .toUpperCase();<br>                return (agent0.getNodeName().compareTo(nodeURL) == 0) &amp;&amp;<br>                (agent1.getNodeName().compareTo(nodeURL) == 0) &amp;&amp;<br>                (agent2.getNodeName().compareTo(nodeURL) == 0);<br>            }<br>        }<br>    }<br><br>    public boolean preConditions() throws Exception {<br>        return getNode() != null;<br>    }<br><br>    public void action() throws Exception {<br>        throw new Exception("This test doesn't work in standalone mode");<br>    }<br><br>    public Object action(Agent group) throws Exception {<br>        this.group = group;<br>        this.group.moveTo(getNode().getNodeInformation().getURL());<br>        return null;<br>    }<br><br>    public void initTest() throws Exception {<br>        // nothing to do<br>    }<br><br>    public void endTest() throws Exception {<br>        // nothing to do<br>    }<br>}<br> </code></pre>
      </td>
    </tr>
  </tbody>
</table>
<table align="center" width="96%" border="1" cellpadding="5"
 cellspacing="0">
  <tbody>
    <tr>
      <th align="center" bgcolor="#ccccff">TestGroupCreation.java</th>
    </tr>
    <tr>
      <td>
      <pre> <code><br>import org.objectweb.proactive.core.group.Group;<br>import org.objectweb.proactive.core.group.ProActiveGroup;<br>import org.objectweb.proactive.core.node.Node;<br><br>import testsuite.test.ProActiveFunctionalTest;<br><br>import java.io.Serializable;<br><br>public class TestGroupCreation extends ProActiveFunctionalTest<br>    implements Serializable {<br>    private Agent group = null;<br><br>    public TestGroupCreation() {<br>        super(null, "Group Creation",<br>            "Create a Group of active object in specify node.");<br>    }<br><br>    public TestGroupCreation(Node node) {<br>        super(node, "Group Creation",<br>            "Create a Group of active object in specify node.");<br>    }<br><br>    // Default action method<br>    public void action() throws Exception {<br>        createGroupAgent();<br>    }<br><br>    // For interlinked tests action method<br>    public Agent action(Object o) throws Exception {<br>        createGroupAgent();<br>        return this.group;<br>    }<br><br>    private void createGroupAgent() throws Exception {<br>        Object[][] params = {<br>            { "Agent0" },<br>            { "Agent1" },<br>            { "Agent2" }<br>        };<br>        Node node = getNode();<br>        Node[] nodes = { node };<br>        group = (Agent) ProActiveGroup.newGroup(Agent.class.getName(), params,<br>                nodes);<br>    }<br><br>    public boolean postConditions() throws Exception {<br>        if (group == null) {<br>            return false;<br>        } else {<br>            Group agentGroup = ProActiveGroup.getGroup(group);<br>            if (agentGroup.size() != 3) {<br>                return false;<br>            } else {<br>                Agent agent0 = (Agent) agentGroup.get(0);<br>                Agent agent1 = (Agent) agentGroup.get(1);<br>                Agent agent2 = (Agent) agentGroup.get(2);<br>                String nodeURL = getNode().getNodeInformation().getURL()<br>                                     .toUpperCase();<br><br>                return (agent0.getNodeName().compareTo(nodeURL) == 0) &amp;&amp;<br>                (agent1.getNodeName().compareTo(nodeURL) == 0) &amp;&amp;<br>                (agent2.getNodeName().compareTo(nodeURL) == 0);<br>            }<br>        }<br>    }<br><br>    public boolean preConditions() throws Exception {<br>        return getNode() != null;<br>    }<br><br>    public void initTest() throws Exception {<br>        // nothing to do<br>    }<br><br>    public void endTest() throws Exception {<br>        // nothing to do<br>    }<br>}<br></code></pre>
      </td>
    </tr>
  </tbody>
</table>
<table align="center" width="96%" border="1" cellpadding="5"
 cellspacing="0">
  <tbody>
    <tr>
      <th align="center" bgcolor="#ccccff"><a name="agent"></a>Agent.java</th>
    </tr>
    <tr>
      <td>
      <pre> <code><br>import org.objectweb.proactive.Body;<br>import org.objectweb.proactive.EndActive;<br>import org.objectweb.proactive.InitActive;<br>import org.objectweb.proactive.ProActive;<br>import org.objectweb.proactive.RunActive;<br><br>public class Agent implements InitActive, RunActive, EndActive,<br>    java.io.Serializable {<br>    private String name;<br>    private String nodename;<br>    private String hostname;<br><br>    public Agent() {<br>    }<br><br>    public Agent(String name) {<br>        this.name = name;<br>    }<br><br>    public String getName() {<br>        try {<br>            //return the name of the Host<br>            return java.net.InetAddress.getLocalHost().getHostName()<br>                                       .toUpperCase();<br>        } catch (Exception e) {<br>            e.printStackTrace();<br>            return "getName failed";<br>        }<br>    }<br><br>    public String getNodeName() {<br>        try {<br>            //return the name of the Node  <br>            return ProActive.getBodyOnThis().getNodeURL().toUpperCase();<br>        } catch (Exception e) {<br>            e.printStackTrace();<br>            return "getNodeName failed";<br>        }<br>    }<br><br>    public void moveTo(String nodeURL) {<br>        try {<br>            System.out.println(" I am going to migate");<br>            ProActive.migrateTo(nodeURL);<br>            System.out.println("migration done");<br>        } catch (Exception e) {<br>            e.printStackTrace();<br>        }<br>    }<br><br>    public void endBodyActivity() {<br>        ProActive.getBodyOnThis().terminate();<br>    }<br><br>    public void initActivity(Body body) {<br>        System.out.println("Initialization of the Activity");<br>    }<br><br>    public void runActivity(Body body) {<br>        org.objectweb.proactive.Service service = new org.objectweb.proactive.Service(body);<br>        while (body.isActive()) {<br>            // The synchro policy is FIFO<br>            service.blockingServeOldest();<br>        }<br>    }<br><br>    public void endActivity(Body body) {<br>        System.out.println("End of the activity of this Active Object");<br>    }<br>}<br> </code></pre>
      </td>
    </tr>
  </tbody>
</table>
</body>
</html>
