<!DOCTYPE HTML PUBLIC "-//IETF//Dtd HTML//EN">
<html>
<head>
  <title>ProActive -</title>
  <link rel="stylesheet" href="../../ProActive.css">
</head>
<body bgcolor="#ffffff">
	 <!--
 Header : start 
~~~ -->
<table width="100%">
  <tbody>
    <tr>
      <td align="left" valign="middle">
      <table cellpadding="2" cellspacing="0" border="1">
        <tbody>
          <tr>
          <td class="smallLink1">&nbsp;&nbsp;<a class="smallLink1" href="../../../../../../overview-summary.html">back to API</a>&nbsp;&nbsp;</td>
    <td class="smallLink1">&nbsp;&nbsp;<a class="smallLink1" href="../../index.html">back to index</a>&nbsp;&nbsp;</td>
          <td class="smallLink1">&nbsp;&nbsp;<a class="smallLink1" href="../index.html">back 
to guided tour index</a>&nbsp;&nbsp;</td>
            
          <td class="smallLink2">&nbsp;&nbsp;<a class="smallLink2"
 href="initializedhello.html">prev</a>&nbsp;&nbsp;</td>
            
          <td class="smallLink2">&nbsp;&nbsp;<a class="smallLink2"
 href="migratablehelloframe.html">next</a>&nbsp;&nbsp;</td>
          </tr>
        </tbody>
      </table>
      </td>
      <td align="right" valign="top"> <a
 href="http://www-sop.inria.fr/oasis/ProActive/"><img
 src="../../ProActiveLogo200x34.gif" width="200" height="34"
 border="0"></a> </td>
    </tr>
  </tbody>
</table>
<hr><!-- Link to index : end -->
<h1>1.3. A simple migration example</h1>
<p>This program is a very simple one : it creates an active object
that migrates between virtual machines. It is a extension of the
previous client-server example, the server now being mobile.</p>
<h2>1.3.1. Required conditions</h2>
<p>The conditions for MigratableHello to be a migratable active object are : </p>
<p>- it must have a constructor without parameters : this is a result of a 
ProActive 
  restriction : the active object having to implement a no-arg constructor. </
p>
<p>- implement the Serializable interface (as it will be transferred through the 
  network).</>
  
<p></p>
  <p>Hello, the superclass, must be able to be serialized, in order to be transferred remotely. It 
  does not have to implement directly java.io.Serializable, but its attributes 
  should be serializable - or transient. For more information on this topic, 
check 
  the <a 
href="http://www-sop.inria.fr/oasis/ProActive/doc/api/org/objectweb/proactive/doc-files/Migration.html">manual</a>.</p><p></p>
<h2>1.3.2. design</h2>
<p>We want to further enhance InitializedHello it by making migratable : we'd like to be able to move it 
across virtual machines. </p>
<p>Thus, we create a MigratableHello class, that derives from InitializedHello. This class will implement 
  all the non-functionnal behavior concerning the migration, for which this example 
  is created. The Hello class (and InitializedHello) is left unmodified.</p>
<p> <em>Note that the migration has to be initiated <u>by the active object itself</u>. 
  This explains why we have to write the moveTo method in the code of MigratableHello 
  - i.e. a method that contains an explicit call to the migration primitive. (cf 
  <a href="http://www-sop.inria.fr/oasis/ProActive/doc/api/org/objectweb/proactive/doc-files/Migration.html">migration 
  documentation</a>)</em></p>
<p>MigratableHello also implements a factory method for instanciating itself as an 
  active object : <code>static MigratableHello createMigratableHello(String : name)</code></p>
<p>The class diagram for the application is the following :</p>
<p><img src="../pics/hello/migratablehello.gif"></p>
<h2>1.3.3. Programming</h2>
<h3>a) the MigratableHello class</h3>
<p>The code of the MigratableHello class is <a href="code/MigratableHello.java.html">here</a>.</p>
<p>MigratableHello derives from the Hello class from the previous example</p>
<p>MigratableHello being the active object itself, it has to :</p>
<p>- implement the Serializable interface</p>
<p>- provide a no-arg constructor</p>
<p>- provide an implementation for using ProActive's migration mechanism.</p>
<p>A new method getCurrentNodeLocation is added for the object to tell the node
where it resides..</p>
<p>A factory static method is added for ease of creation.</p>
  <p>The migration is initiated by the moveTo method :</p>
  <pre class="snippet">
/** method for migrating
* @param destination_node destination node
*/
public void moveTo(String destination_node) {
	System.out.println("\n-----------------------------");
	System.out.println("starting migration to node : " + destination_node);
	System.out.println("...");
	try {
		// THIS MUST BE THE LAST CALL OF THE METHOD
		ProActive.migrateTo(destination_node);
	} catch (MigrationException me) {
		System.out.println("migration failed : " + me.toString());
	}
}
</pre>
  <p>Note that the call to the ProActive primitive <code>migrateTo</code> is the last one of the method
    moveTo. See the <a href="../../Migration.html">manual</a> for more information.</p>
<h3>c) the client class</h3>
<p>The entry point of the program is written in a separate class : <a href="code/MigratableHelloClient.java.html">MigratableHelloClient</a></p>
<p>It takes as arguments the locations of the nodes the object will be migrated
  to.</p>
<p>The program calls the factory method of MigratableHello to create an instance of
  an active object. It then moves it from node to node, pausing for a while between
  the transfers.</p>
  <h2>1.3.4. Execution</h2>
<p>- start several nodes using the <code>startnode</code> script.</p>
<p>- compile and run the program (run MigratableHelloClient), passing in parameter the urls of the nodes 
you'd 
  like the agent to migrate to.</p>
<p>- don't forget to set the security permissions</p>
<p>- observe the instance of MigratableHello migrating :</p>
<p>&nbsp;</p>
<p><img src="../pics/hello/agent_execution.gif"></p>
<p>During the execution, a default node is first created. It then hosts the 
created 
  active object. Then the active object is migrated from node to node, each time 
  returning &quot;hello&quot; and telling the client program where it is located.<br>
</p>
</body>
</html>