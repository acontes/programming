<!DOCTYPE HTML PUBLIC "-//IETF//Dtd HTML//EN">
<html>
  <head>
    <title>ProActive guided tour</title>
<link rel="stylesheet" href="../../ProActive.css">
  </head>
  <body bgcolor="#ffffff">
  	<!--
 Header : start 
~~~ -->
<table width="100%">
  <tr> 
    <td align="left" valign="middle"> <table cellpadding="2" cellspacing="0" 
border="1">
        <tr> 
          <td class="smallLink1">&nbsp;&nbsp;<a class="smallLink1" href="../../../../../../overview-summary.html">back to API</a>&nbsp;&nbsp;</td>
    <td class="smallLink1">&nbsp;&nbsp;<a class="smallLink1" href="../../index.html">back to index</a>&nbsp;&nbsp;</td>
          <td class="smallLink1">&nbsp;&nbsp;<a class="smallLink1" href="../index.html">back 
to guided tour index</a>&nbsp;&nbsp;</td>
          <td class="smallLink2">&nbsp;&nbsp;<a class="smallLink2" 
href="clientserver.html">prev</a>&nbsp;&nbsp;</td>
          <td class="smallLink2">&nbsp;&nbsp;<a class="smallLink2" 
href="migratablehello.html">next</a>&nbsp;&nbsp;</td>
        </tr>
      </table></td>
    <td  align="right" valign="top"> <a 
href="http://www-sop.inria.fr/oasis/ProActive/"><img 
src="../../ProActiveLogo200x34.gif" width="200" height="34" 
border="0"/></a> </td>
  </tr>
</table>
<hr>
	<!-- Link to index : end -->
	

<h1>3.2. Initialization of the activity</h1>

<p>Active objects, as indicates their name, have an activity of their own (an internal thread).<br>
It is possible to add pre and post processing to this activity, just by implementing the interfaces
InitActive and EndActive, that define the methods initActivity and endActivity.</p>

<p>The following example will help you to understand how and when you can initialize and clean the 
activity.</p>

<p>When instanciated, the activity of an object is automatically started, but it will first do what is written in
the initActivity method.</p>

<p>Ending the activity can only be done from inside the active object (i.e. from a call to its own body). This is the 
reason why we have written a terminate method in the following example.</p>



<h2>Design of the application</h2>
<p>The InitializedHello class extends the Hello class, and implements the interfaces InitActive and EndActive.It acts a a server
for the InitializedHelloClient class.</p><p>The main method is overriden so that it can instantiate the InitializedHello class</p>
<img src="../pics/hello/initializedhello.gif"> 
<h2>Programming</h2>
<h3>InitializedHello</h3>
<p>The source code of the InitializedHello class is <a href="code/InitializedHello.java.html">here</a>.</p>
<p>initActivity and endActivity here just log messages onto the console, so you can see when they are called.</p>
<p>initActivity is called at the creation of the active object, while endActive is called after the activity has terminated 
(thanks to the method terminate).</p>
 
<p>Here is the initActivity method :</p>
<pre class="snippet">
public void initActivity(Body body) {
	System.out.println("I am about to start my activity");
}
</pre>
<p>Here is the endActivity method :</p>
<pre class="snippet">
public void endActivity(Body body) {
	System.out.println("I have finished my activity");
}
</pre>
<p>The following code shows how to terminate the activity of the active object :</p>
<pre class="snippet">
public void terminate() {
	// the termination of the activity is done through a call on the
	// terminate method of the body associated to the current active object
	ProActive.getBodyOnThis().terminate();
}
</pre>

<p>The only differences from the  the previous example is the classes instantiated, which are now InitializedHello (and not Hello) and InitializedHelloClient, and you will add a call to hello.terminate(). 
</p>
<p><b>InitializedHello</b>: Code is <a href="code/InitializedHello.java.html">here</a>.</p>
<p><b>InitializedHelloClient</b>: Code is <a href="code/InitializedHelloClient.java.html">here</a>.</p>

<p>So, create InitializedHelloClient.java and InitializedHello.java in src/org/objectweb/proactive/examples/hello </p>
<p>Now compile all proactive sources</p>
<pre>cd compile
windows>build.bat examples
linux>build examples
cd ..</pre>
<p>Add "./classes" directory to CLASSPATH to use these two new source files</p>
<code>windows>set CLASSPATH=.;.\classes;.\ProActive_examples.jar;.\ProActive.jar;.\lib\bcel.jar;.\lib\asm.jar;.\lib\log4j.jar;.\lib\xercesImpl.jar;.\lib\fractal.jar;.\lib\bouncycastle.jar</code>
<code>linux>export CLASSPATH=.:./classes:./ProActive_examples.jar:./ProActive.jar:./lib/bcel.jar:./lib/asm.jar:./lib/log4j.jar:./lib/xercesImpl.jar:./lib/fractal.jar:./lib/bouncycastle.jar</code>

<h2>Execution</h2>
<p>Execution is similar to the previous example; just use the InitializedHelloClient client class and InitializedHello server class.<br>
<h4>Starting the server</h4>
<code>
linux>   java -Djava.security.policy=scripts/proactive.java.policy -Dlog4j.configuration=file:scripts/proactive-log4j org.objectweb.proactive.examples.hello.InitializedHello<br><br>
windows> java -Djava.security.policy=scripts\proactive.java.policy -Dlog4j.configuration=file:scripts\proactive-log4j org.objectweb.proactive.examples.hello.InitializedHello &
</code>

<h4>Launching the client</h4>
<code>
linux>   java -Djava.security.policy=scripts/proactive.java.policy -Dlog4j.configuration=file:scripts/proactive-log4j org.objectweb.proactive.examples.hello.InitializedHelloClient //localhost/Hello<br><br>
windows> java -Djava.security.policy=scripts\proactive.java.policy -Dlog4j.configuration=file:scripts\proactive-log4j org.objectweb.proactive.examples.hello.InitializedHelloClient //localhost/Hello
</code>

</body>
</html>
