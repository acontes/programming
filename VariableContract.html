<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<head>
  <title>Variable Contracts for Descriptors</title>
  <link rel="stylesheet" href="ProActive.css">
</head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<body style="background-color: white;">
<table width="100%">
  <tbody>
    <tr>
      <td align="left" valign="middle">
      <table border="1" cellpadding="2" cellspacing="0">
        <tbody>
          <tr>
            <td class="smallLink1">&nbsp;&nbsp;<a class="smallLink1" href="../../../../overview-summary.html">back to API</a>&nbsp;&nbsp;</td>
            <td class="smallLink1">&nbsp;&nbsp;<a class="smallLink1" href="index.html">back to index</a>&nbsp;&nbsp;</td>
            <td class="smallLink2">&nbsp;&nbsp;<a class="smallLink2" href="Descriptor.html#processes">prev</a>&nbsp;&nbsp;</td> 
 	    <td class="smallLink2">&nbsp;&nbsp;<a class="smallLink2" href="FileTransfer.html">next</a>&nbsp;&nbsp;</td>
          </tr>
        </tbody>
      </table>
      </td>
      <td align="right" valign="top">
      <img src="ProActiveLogo200x34.gif"></td>
    </tr>
  </tbody>
</table>
<HR>
<H1>Variable Contracts for Descriptors</H1>
<H2>Principle</H2>
<P>The objective of this feature is to allow the use of variables with
XML descriptors. Variables can be defined: directly in the descriptor, using
independent files, or inside the deploying application's code (with an API).</P>

<P>The variable tags are usefull inside a descriptor because they can factorize frequent parameters. (For example, a variable like ${PROACTIVE_HOME} can be defined, set and used in an XML Descriptor.) But also, because they can be used to establish a contract between the Program and the Descriptor.</P>

<h2><a name="variableTypes">Variable Types</a></h2>

	   <ul><table>
	  		<tr>
				<th><p>Type</p></th>
				<th><p>Ability to set value</p></th>
				<th><p>Ability to set empty value</p></th>
				<th><p>Priority</p></th>
			</tr>
			<tr>
				<td><p><b>DescriptorVariable</b></p></td>
				<td><p align="center">Descriptor</p></td>
				<td><p align="center">Program</p></td>
				<td><p align="center">Descriptor</p></td>
			</tr>
			<tr>
				<td><p><b>ProgramVariable</b></p></td>
				<td><p align="center">Program</p></td>
				<td><p align="center">Descriptor</p></td>
				<td><p align="center">Program</p></td>
			</tr>
			<tr>
				<td><p><b>DescriptorDefaultVariable</b></p></td>
				<td><p>Descriptor, Program</p></td>
				<td><p align="center"> - </p></td>
				<td><p align="center">Program</p></td>
			</tr>
			<tr>
				<td><p><b>ProgramDefaultVariable</b></p></td>
				<td><p align="center">Program, Descriptor</p></td>
				<td><p align="center"> - </p></td>
				<td><p align="center">Descriptor</p></td>
			</tr>
			<tr>
				<td><p><b>JavaPropertyVariable</b></p></td>
				<td><p align="center">Descriptor, Program</p></td>
				<td><p align="center"> - </p></td>
				<td><p align="center"> - </p></td>
			</tr>

	   </table></ul>

<p> Variables can be set in more than one place. When the value is set on multiple places, then the definition specified in the priority column will take precedence.</p>

<h2><a name="variableTypesDesc">Variable Types User Guide</a></h2>
<p> To help identify the user cases where the variable types might be useful, we have defined the concept of programmer and deployer. The programmer is the person writing the application code. The deployer corresponds to the responsible of writing the deployment descriptor. The variables represent rights and responsabilities between the two parties (contract) as specified in the following table:</p>

	   <ul><table>
	  		<tr>
				<th><p>Type</p></th>
				<th><p>Behavior</p></th>
				<th><p>When to use this type</p></th>
			</tr>
			<tr>
				<td><p><b>DescriptorVariable</b></p></td>
				<!--td><p>Garanties that the value must be set in the descriptor, and cannot be specified in the program.</p></td-->
				<td><p>The value has to be set in the descriptor, and cannot be specified in the program.</p></td>
				<!--td><p>The program can define this variable to empty, to force the descriptor to set a value. The descriptor can use this type when it doesn't want the program to have the ability to change the value.</p></td-->
				<td><p>If the deployer wants to use a value, without giving the possibility to the programmer to modify it. The programmer can define this variable to empty, to force the descriptor to set a value.</p></td>
			</tr>
			<tr>
				<td><p><b>ProgramVariable</b></p></td>
				<!--td><p>Garanties that the value must be set in the program, and cannot be specified in the descriptor.</p></td-->
				<td><p>The value must be set in the program, and cannot be specified in the descriptor.</p></td>
				<!--td><p>The descriptor can define this variable to empty, to force the program to set a value. The program can use this type when it doesn't want the descriptor to have the ability to change the value.</p></td-->
				<td><p>If the programmer wants to use a value, without giving the possibility to the descriptor to modify it. The descriptor can define this variable to empty, to force the programmer to set a value.</p></td>
			</tr>
			<tr>
				<td><p><b>DescriptorDefaultVariable</b></p></td>
				<!--td><p>Garanties that the descriptor will always provide a default value. The program may also set a value for this variable, overriding the default.</p></td-->
				<td><p>A default value must be specified in the descriptor. The programmer has the ability not to change the value in the program. Nevertheless, if the value is changed in the program, then this new value will have precedence over the one defined in the descriptor.</p></td>
				<td><p>If the programmer may override the default value, but the responsability of setting a default belongs to the deployer.</p></td>
			</tr>
			<tr>
				<td><p><b>ProgramDefaultVariable</b></p></td>
				<!--td><p>Garanties that the program will always provide a default value. The descriptor may also set a value for this variable, overriding the default.</p></td-->
				<td><p>A default value must be specified in the program. The descriptor has the ability not to change the value. Nevertheless, if the value is changed in the descriptor, then this new value will have precedence over the one defined in the program.</p></td>
				<td><p>If the deployer may override the default value, but the responsability of setting a default belongs to the programmer.</p></td>
			</tr>
			<tr>
				<td><p><b>JavaPropertyVariable</b></p></td>
				<td><p>Takes the value from the corresponding Java property.</p></td>
				<td><p>When a variable will only be known at runtime through the Java properties.</p></td>
			</tr>

	   </table></ul>
	
<H2>Variables Example</H2>
<H3>Descriptor Variables</H3>
<p>All variables must be set in a variable section at the beginning of the descriptor file in the following way:</p>

<pre CLASS="xml">
	&lt;variables&gt;
	&nbsp;&lt;<b>DescriptorVariable</b> name="<b>PROACTIVE_HOME</b>" value="<b>ProActive/dist/ProActive</b>"/&gt;
	&nbsp;&lt;<b>DescriptorDefaultVariable</b> name="<b>NUMBER_OF_VIRTUAL_NODES</b>" value="<b>4</b>"/&gt;
	&nbsp;&lt;<b>ProgramVariable</b> name="<b>VIRTUAL_NODE_NAME</b>" value="<b></b>"/&gt;	  
	
	&nbsp;<FONT ID="FormalComment">&lt;!-- Example Using java properties --&gt;</FONT>
	&nbsp;&lt;<b>JavaPropertyVariable</b> name="<b>USER_HOME</b>" value="<b>java.home</b>"/&gt;

	&nbsp;<FONT ID="FormalComment">&lt;!-- Include external variables from files--&gt;</FONT>
	&nbsp;&lt;<b>IncludeXMLFile</b> location="<b>file.xml</b>"/&gt;
	&nbsp;&lt;<b>IncludePropertyFile</b> location="<b>file.properties</b>"/&gt;
	&lt;/variables&gt;

	...
	<FONT ID="FormalComment">&lt;!-- Usage example--&gt;</FONT>
	&lt;classpath&gt;
	&nbsp;&lt;absolutePath value="<b>${USER_HOME}/${PROACTIVE_HOME}/ProActive.jar</b>"/&gt;
	&nbsp;...
	&lt;/classpath&gt;
	...
</pre>

<h3>Program Variables</h3>
<PRE CLASS="snippet" >
VariableContract variableContract= new VariableContract();
	
variableContract.setVariableFromProgram( "<b>VIRTUAL_NODE_NAME</b>", "<b>testnode</b>", <b>VariableContractType.ProgramVariable</b>);
variableContract.setVariableFromProgram( "<b>NUMBER_OF_VIRTUAL_NODES</b>", "<b>10</b>", <b>VariableContractType.DescriptorDefaultVariable</b>);
	
ProActiveDescriptor pad = ProActive.getProactiveDescriptor(XML_LOCATION, variableContract);
</pre>
<br>

<H2>External Variable Definitions Files</H2>

<h3>XML Files</h3>
<P>Is built using XML property tags.</P>
    <P STYLE="border: none; padding: 0cm; line-height: 150%"><FONT FACE="Verdana, Helvetica, Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt"><B>File 
      : file.xml</B></FONT></FONT></P>
    <TABLE WIDTH=100% CELLPADDING=2 CELLSPACING=0>
      <COL WIDTH=256*>
      <TR> 
        <TD WIDTH=100%> <TABLE CLASS="xml" DIR="LTR" ALIGN=LEFT WIDTH=663 CELLPADDING=2 CELLSPACING=0>
            <COL WIDTH=659>
            <TR> 
              <TD  WIDTH=659 align="left"> 
	      <PRE CLASS="xml">

	<FONT ID="FormalComment">&lt;!-- Definition of the specific context --&gt;</FONT>
	&lt;variables&gt;
	&nbsp;&lt;<b>DescriptorVariable</b> name="<b>USER_HOME</b>" value="<b>/usr/home/team</b>"/&gt;
	&nbsp;&lt;<b>DescriptorVariable</b> name="<b>PROACTIVE_HOME</b>" value="<b>ProActive/dist/ProActive</b>"/&gt;
	&nbsp;&lt;<b>DescriptorVariable</b> name="<b>NUM_NODES</b>" value="<b>45</b>"/&gt;
	&lt;/variables&gt;
	</PRE>
	  	</TD>
            </TR>
          </TABLE></TD>
      </TR>
    </TABLE>


<h3>Properties Files</h3>

<P>This approach uses <a href="http://java.sun.com/j2se/1.4.2/docs/api/java/util/Properties.html#load(java.io.InputStream)">Sun microsystems properties file format</a>. The format is plain text with one definition per line in the format <b>variable = value</b>, as shown in the following example:</P>
    
    <P STYLE="border: none; padding: 0cm; line-height: 150%"><FONT FACE="Verdana, Helvetica, Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt"><B>File 
      : file.properties</B></FONT></FONT></P>
    <TABLE WIDTH=100% CELLPADDING=2 CELLSPACING=0>
      <COL WIDTH=256*>
      <TR> 
        <TD WIDTH=100%> <TABLE CLASS="xml" DIR="LTR" ALIGN=LEFT WIDTH=663 CELLPADDING=2 CELLSPACING=0>
            <COL WIDTH=659>
            <TR> 
              <TD  WIDTH=659 align="left">
	      <PRE CLASS="xml">

	<FONT ID="FormalComment"># Definition of the specific context</FONT>
	USER_HOME = /usr/home/team
	PROACTIVE_HOME = ProActive/dist/ProActive
	NUM_NODES : 45
	</PRE></TD>
            </TR>
          </TABLE></TD>
      </TR>
    </TABLE>
<p>Variables defined in this format will be declared as <b>DescriptorVariable</b> type. Note that colon (:) can be used instead of equal (=).</p>
    
<H2>Program Variable API</H2>


<h3> Relevant import packages </h3>
<pre class="snippet">
import org.objectweb.proactive.core.xml.VariableContract;
import org.objectweb.proactive.core.xml.VariableContractType;
</pre>

<h3>Available Variable Types</h3>
<ul>
	<li>VariableContractType.<b>DefaultVariable</b></li>
	<li>VariableContractType.<b>DescriptorDefaultVariable</b></li>
	<li>VariableContractType.<b>ProgramVariable</b></li>
	<li>VariableContractType.<b>ProgramDefaultVariable</b></li>
	<li>VariableContractType.<b>JavaPropertyVariable</b></li>
</ul>

<h3>API</h3>

<P>The API for setting variables from the Program is shown below. The <b>name</b> corresponds to the variable name, and the <b>value</b> to the variable content. The <b>type</b> corresponds to an VariableContractType (<a href="#variableTypes">supported variable types</a>).</P>

<pre class="snippet">
public void VariableContract.setVariableFromProgram( String <b>name</b>, String <b>value</b>, VariableContractType <b>type</b>);
public void VariableContract.setVariableFromProgram( HashMap <b>map</b>, VariableContractType <b>type</b>);</pre>
<P>The API for adding a multiple variables is shown above. The variable <b>name</b>/<b>value</b> pair is specified as the key/content of the HashMap.</P>


<br>
<HR>
<P ALIGN=RIGHT STYLE="margin-bottom: 0cm"><FONT FACE="Verdana, Helvetica, Arial, sans-serif"><FONT SIZE=1 STYLE="font-size: 8pt">Copyright
&copy; April 2005 INRIA All Rights Reserved.</FONT></FONT>
</P>
</BODY>
</HTML>
