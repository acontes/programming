<?xml version="1.0" encoding="UTF-8"?>
<chapter><title>Hello world ! (tiny example)</title>

<!--  File: /home/irosenbe/PA_new_doc/docbook-tuto/doc-files/TinyHelloWorld.html  -->
  

    <para> This example implements the smallest program in ProActive. This is the
 easiest program you could write, using the Active Object concept. This is just to show quickly
 how code can be written, with minimal knowledge of the API.</para>
    <para>You can get a more complete &quot;hello world&quot; example, with deployment on a remote host, <ulink url="HelloWorld.xml">further on</ulink> in the manual.</para>
    <para>A client object displays a <literal>String</literal> received from elsewhere (the original VM). This
 illustrates the creation of an Active Object.</para>
    <para>Only one classe is needed : we have put the main method inside the class,
 which when deployed will be an Active Object.</para>
    <sect1 remap="h2">
      <title>The TinyHello class</title>
      <para>This class can be used as an Active Object, serving requests. Its creation
 involves the following steps:</para>
      <itemizedlist>
        <listitem>
          <para> Provide an implementation for the required server-side functionalities</para>
        </listitem>
        <listitem>
          <para> Provide an empty, no-arg constructor</para>
        </listitem>
        <listitem>
          <para> Write a <literal>main</literal> method in order to instantiate one server object.</para>
        </listitem>
</itemizedlist>
      <para>Here is a possible implementation for the <literal>TinyHello</literal> class:</para>
      <informaltable frame="all">
        <tgroup cols="1">
          <colspec colname="c1" colwidth="100*"/>
          <tbody>
            <row>
              <entry align="center" valign="middle"><para><emphasis role="bold">TinyHello.java</emphasis></para></entry>
            </row>
            <row>
              <entry><para>
                  <screen>
package org.objectweb.proactive.examples.hello;

import org.apache.log4j.Logger;
import org.objectweb.proactive.ProActive;
import org.objectweb.proactive.core.util.log.*;
import org.objectweb.proactive.core.util.wrapper.StringMutableWrapper;
import java.net.UnknownHostException;

/** 
 * A stripped-down Active Object example.
 * The object has only one public method, sayHello()
 * The object does nothing but reflect the host its on. 
 */

public class TinyHello implements java.io.Serializable {
    static Logger logger = ProActiveLogger.getLogger(Loggers.EXAMPLES);
    private final String message = &quot;Hello World!&quot;;

    /** ProActive compulsory no-args constructor */
    public TinyHello() {
    }

    /** The Active Object creates and returns information on its location
     * @return a StringWrapper which is a Serialized version, for asynchron\
y */
    public StringMutableWrapper 
sayHello()
 {
        return new StringMutableWrapper(
            this.message + &quot;\n from &quot; + getHostName() + &quot;\n at &quot; +
            new java.text.SimpleDateFormat(&quot;dd/MM/yyyy HH:mm:ss&quot;).format(new \
java.util.Date()));
    }

    /** finds the name of the local machine */
    static String getHostName() {
        try {
            return java.net.InetAddress.getLocalHost().toString();
        } catch (UnknownHostException e) {
            return &quot;unknown&quot;;
        }
    }

    /** The call that starts the Acive Objects, and displays results.
     * @param args must contain the name of an xml descriptor */
    public static void main(String[] args)
        throws Exception {
        // Creates an active instance of class Tiny on the local node
        TinyHello tiny = (TinyHello) ProActive.newActive(
                TinyHello.class.getName(), 
// the class to deploy
                null 
// the arguments to pass to the constructor, here none
            );  

        // get and display a value 
        StringMutableWrapper received = 
tiny.sayHello();
 // possibly remote call
        logger.info(&quot;On &quot; + getHostName() + &quot;, a message was received: &quot; + rece\
ived); // potential wait-by-necessity 
    }
}
                  </screen>
</para></entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>
      <para></para>
      <para></para>
    </sect1>
    <sect1 remap="h2">
      <title>Implement the required functionalities</title>
      <para>Implementing any remotely-accessible functionality is simply done through
 normal Java methods in a normal Java class, in exactly the same manner it would have been done in
 a non-distributed version of the same class. Here, the only method is <literal>sayHello</literal></para>
    </sect1>
    <sect1 remap="h2">
      <title>Creating the <literal>Hello</literal> Active Object</title>
      <para>Now that we know how to write the class that implements the required
 server-side functionalities, let us see how to create the server object. We want this active
 object to be created on the current node, which is why we use <literal>newActive</literal> with only
 two parameters (done in the <literal>main</literal> method).</para>
      <para>The code snippet which instantiates the <literal>TinyHello</literal> in the same VM is the following
 (in the <literal>main</literal> method):</para>
      <screen>
        TinyHello tiny = (TinyHello) ProActive.newActive(
                TinyHello.class.getName(), // the class to deploy
                null // the arguments to pass to the constructor, here none
            ); // which jvm should be used to hold the Active Object
      </screen>
    </sect1>
    <sect1 remap="h2">
      <title>Invoking a method on a remote object and printing out the message</title>
      <para>This is exactly like invoking a method on a local object of the same type.
 The user does not have to deal with catching distribution-related exceptions.</para>
      <para>As already stated, the only modification brought to the code by ProActive
 is located at the place where active objects are created. All the rest of the code remains the
 same, which fosters software reuse. So the way to call the <literal>sayHello</literal> method in this
 example is the following (in the <literal>main</literal> method):</para>
      <screen>
        StringMutableWrapper received = tiny.sayHello(); // possibly remote\
 call
        logger.info(&quot;On &quot; + getHostName() + &quot;, a message was received: &quot; + rece\
ived); // potential wait-by-necessity 
      </screen>
    </sect1>
    <sect1 remap="h2">
      <title>Launching</title>
      <para>To launch the example, you may type :</para>
      <para><literal>linux&gt; java -Djava.security.policy=scripts/proactive.java.policy
 -Dlog4j.configuration=file:scripts/proactive-log4j
 org.objectweb.proactive.examples.hello.TinyHello
 windows&gt; java -Djava.security.policy=scripts\proactive.java.policy
 -Dlog4j.configuration=file:scripts\proactive-log4j
 org.objectweb.proactive.examples.hello.TinyHello</literal></para>
      <para>There are also scripts in the <literal>scripts</literal> directory :</para>
      <para><literal>linux&gt; cd scripts/unix/
 linux&gt; tinyHello.sh
 windows&gt; cd scripts/windows
 windows&gt; tinyHello.bat</literal></para>
      <sect2 remap="h3">
        <title>The output</title>
        <screen>
[apple unix]tinyhello.sh

--- Hello World tiny example ---------------------------------------------
 --&gt; This ClassFileServer is reading resources from classpath
ProActive Security Policy (proactive.runtime.security) not set. Runtime Sec\
urity disabled
Created a new registry on port 1099
//apple.inria.fr/Node628280013 successfully bound in registry at //apple.in\
ria.fr/Node628280013
Generating class : pa.stub.org.objectweb.proactive.examples.hello.Stub_Tiny\
Hello
Generating class : pa.stub.org.objectweb.proactive.core.util.wrapper.Stub_S\
tringMutableWrapper
On apple/138.96.218.62, a message was received: Hello World!
 from apple/138.96.218.62
 at 03/11/2005 14:25:32
        </screen>
        <para></para>
        <para></para>
        <para>
  </para>
      </sect2>
    </sect1>
  
</chapter>
