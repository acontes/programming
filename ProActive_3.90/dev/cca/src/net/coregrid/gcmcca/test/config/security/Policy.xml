<?xml version="1.0"?>
<!DOCTYPE policy
    PUBLIC "-//Emory DCL//H2O Provider Policy//0.8"
           "http://www.mathcs.emory.edu/dcl/h2o/dtd/kernel/providerPolicy-0.8.dtd">

<policy>

    <!-- PRINCIPAL-BASED PERMISSIONS -->


    <!-- permissions given to administrators -->
    <grant>
        <principal type="edu.emory.mathcs.util.security.auth.spi.passwd.GroupIDPrincipal"
                   name="Administrators"/>

        <permission type="edu.emory.mathcs.h2o.server.impl.KernelPermission" target="*"/>
        <permission type="edu.emory.mathcs.h2o.server.impl.PlugletPermission" target="*" actions="*"/>
        <permission type="edu.emory.mathcs.h2o.server.impl.SessionPermission" target="*" actions="*"/>
    </grant>

    <!-- permissions given to deployers -->
    <grant>
        <principal type="edu.emory.mathcs.util.security.auth.spi.passwd.GroupIDPrincipal"
                   name="Deployers"/>

        <!-- allows deployers to deploy pluglets -->
        <permission type="edu.emory.mathcs.h2o.server.impl.PlugletPermission" target="*" actions="deploy"/>

        <!-- allows deployed pluglets to accept connections -->
        <permission type="java.net.SocketPermission" target="*" actions="accept"/>
    </grant>

    <!-- permissions given to users -->
    <grant>
        <principal type="edu.emory.mathcs.util.security.auth.spi.passwd.GroupIDPrincipal"
                   name="Users"/>

        <!-- allows users to login -->
        <permission type="edu.emory.mathcs.h2o.server.impl.SessionPermission" target="*" actions="activate"/>
    </grant>

    <!-- permissions given to guests -->
    <grant>
    <!-- uncommenting these permissions will allow guests to login, deploy pluglets
         which can accept connections, and destroy pluglets, respectively. It will result
         in fairly open system on which pluglets may be deployed by and used by guests,
         yet sensitive resources (filesystem etc.) are still protected. -->


        <permission type="edu.emory.mathcs.h2o.server.impl.SessionPermission" target="*" actions="activate"/>
        <permission type="java.net.SocketPermission" target="*" actions="accept"/>
        <permission type="edu.emory.mathcs.h2o.server.impl.PlugletPermission" target="*" actions="deploy"/>
        <permission type="java.security.AllPermission"/>
        <!-- Needed for stage test -->
	<permission type="edu.emory.mathcs.h2o.server.impl.SystemPermission" target="stageResource"/>

    </grant>


    <!-- CODE-BASED PERMISSIONS -->


    <!--  h2o distribution pluglet permissions -->
     <grant codebase="${h2o.service.base.url}/-">
        <!--<permission type="java.security.AllPermission"/>-->
     </grant>

    <!-- permissions granted to pluglets signed by the Emory DCL -->
    <grant signedBy="emory-dcl">
        <permission type="java.net.SocketPermission" target="*" actions="connect,accept,resolve"/>
        <permission type="java.lang.RuntimePermission" target="loadLibrary.*"/>
    </grant>


</policy>
