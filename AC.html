<!-- saved from url=(0022)http://internet.e-mail -->
<!-- saved from url=(0022)http://internet.e-mail -->
<html>
<head>
<title>Automatic Continuation</title>
<link rel="stylesheet" href="ProActive.css">
</head>
<body bgcolor="white">

<!--
 Header : start 
~~~ -->
<table width="100%">
<tr>
<td align="left" valign="middle">
    <table cellpadding="2" cellspacing="0" border="1">
    <tr>
    <td class="smallLink1">&nbsp;&nbsp;<a class="smallLink1" href="../../../../overview-summary.html">back to API</a>&nbsp;&nbsp;</td>
    <td class="smallLink1">&nbsp;&nbsp;<a class="smallLink1" href="index.html">back to index</a>&nbsp;&nbsp;</td>
    <td class="smallLink2">&nbsp;&nbsp;<a class="smallLink2" href="FutureObjectCreation.html">prev</a>&nbsp;&nbsp;</td>
    <td class="smallLink2">&nbsp;&nbsp;<a class="smallLink2" href="HelloWorld.html">next</a>&nbsp;&nbsp;</td>
    </tr>
    </table>
</td>
<td  align="right" valign="top">
<img src="ProActiveLogo200x34.gif"/>
</td>
</tr>
</table>
<hr>
<!-- Link to index : end -->

<h1>Automatic Continuation in ProActive</h1>

<h2>Objectives</h2>
<p class="textNormal">
An Automatic Continuation is due to the propagation of a future outside the activity that has sent the corresponding request.</p>
<p class="textNormal">
Automatic Continuations allow to pass in parameter or return as a result future objects(or objects containing a future) without blocking to wait the result object of the future. When the result is available on the object that originated the creation of the future, this object must update the result in all objects to which  it passed the future.
</p>
<h2>Principles</h2>
<ul class="listWithSpace">
<li class="textNormal"><b>Message sending</b></li>
<p class="textNormal">
Automatic Continuations can occur when sending a request (parameter of the request is a future or contains a future) or when sending a reply (the result is a future or contains a future).
</p>
<p class="textNormal">Outgoing futures are  registered in the <b>FuturePool </b>of the Active Object sending this future(request or reply). Registration for couple(Future,BodyDestination) as an Automatic Continuation occurs when the future is serialized(indeed every request or reply are serialized before being sent, and the future is part of the request or the reply). More precisely, a thread <b>T</b> sending the message(request or reply)---therefore the thread doing the serialization---, keeps in a static table (<b>FuturePool.bodyDestination</b>) a reference of the destination body. Hence when a future <b>F</b> is serialized by the same thread <b>T</b>(since futures are part of request or reply, it is the same thread serializing the request --or reply-- and the future), it looks up in the static table, if there is a destination <b>D</b> registered for the thread <b>T</b>. If true, the future notifies its <b>FuturePool</b> (that it is going to leave), which in turn registers couple (F,D) as an Automatic Continuation</p>
<p class="textNormal">
When value <b>V</b> is available for the future <b>F</b>, <b>V</b> is propagated to all objects that received the fututre <b>F</b>. This Update is realized by a particular thread located in the <b>FuturePool</b>.
</p>
<li class="textNormal"><b>Message reception</b></li>
<p class="textNormal">
When a message is received(request or reply) by an Active Object, this message can contain a future. So the Active Object registers this future in the <b>FuturePool</b> to be able to update it when the value will be available. This registration takes place in two steps:<br></br>
		<ul type="square" class="listWithSpace">
		<li class="textNormal">When the future is deserialized, it registers in a static table (<b>FuturePool.incomingFutures</b></li>
		<li class="textNormal">In Receive[Request-Reply] method, it is checked if one or many futures are registerd in that table, then, if true these futures are registerd in the <b>FuturePool</b> in a standart way.</li></ul></ul>
</p>
		
<h2>Example</h2>
<p class="textNormal">
The following piece of code shows both cases: passing a future as parameter or as a result.</p>
<blockquote><pre>
class C{
....

	public static void main(String[] args){

	......

	A a = newActive(A);
 	A b = newActive(B);

 	Result r1 = a.foo();   //r1 is a future
 	Result r2 = b.bar(r1); //r1 is passed as parameter
	Result r3 = b.bar2();  // see <b>**</b>

	........

	} 	//end of main

...
}	//end of class C
</pre></blockquote>
<p class="textNormal">where</p>
<blockquote><pre>
class A {

  ...
	public Result foo(){
	...
	}
  ...
} //end of class A

class B{
...
 	 public Result bar (Result r) {
	...
 	 }
  
  	public Result bar2 () {
   	 A a = newActive(A);
    	return a.foo();     // <b>**</b> future is sent as a result
 	 }

} //end of class B

</pre></blockquote>

<h2>Illustration of an Automatic Continuation with a future passed as parameter</h2>
<div align="center">
<img src="pics/e1.gif"></img><br>Let us say that some piece of code in main method of an object C calls method <b>foo()</b> on an instance of class A.</br><br></br>
<img src="pics/e2.gif"></img><br> This calll is asynhronous and returns a future object <b>Future_r1</b> of class Result.</br><br></br>
<img src="pics/e3.gif"></img><br>Then method <b>bar()</b> is called on an instance of class B passing future <b>Future_r1</b> as a parameter to the method</br><br></br>
<img src="pics/e4.gif"></img><br>This calll is asynhronous and returns a future object <b>Future_r2</b> of class Result. B needs the value of <b>Future_r1</b> which is not yet available in order to return the result of method <b>bar()</b>, so it gets the future too.</br><br></br>
<img src="pics/e5.gif"></img><br>The value of the result for the call to method <b>foo</b> is now available, so A updates the value of <b>Future_r1</b></br><br></br>
<img src="pics/e6.gif"></img><br>C updates the value of <b>Future_r1</b> for B</br><br></br>
<img src="pics/e7.gif"></img><br>B returns the value for the call to method <b>bar()</b> and updates the value of <b>Future_r2</b> for C</br>
</div>


<!--
 Footer : start 
~~~ -->
<br><hr><div align="right" class="textSmall">Copyright &#169;  2001-2005INRIA All Rights Reserved.</p>
<!-- Footer : end -->
</body>
</html>
